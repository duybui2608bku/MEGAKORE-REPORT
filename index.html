<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mediccare - Báo Cáo & Vinh Danh Telesales</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.40.0/apexcharts.min.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

      :root {
          --primary: #3b82f6;
          --secondary: #1e40af;
          --success: #10b981;
          --info: #0ea5e9;
          --warning: #f59e0b;
          --danger: #ef4444;
          --light: #f8fafc;
          --dark: #1e293b;
          --gray: #94a3b8;
          --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
          --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
          --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
          --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
          --gold: #ffc107;
          --silver: #a0aec0;
          --bronze: #cd7f32;
      }

      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: 'Roboto', sans-serif;
      }

      body {
          background-color: #f1f5f9;
          color: var(--dark);
          line-height: 1.6;
          min-height: 100vh;
          overflow: hidden;
      }

      .page-container {
          width: 100vw;
          height: 100vh;
          overflow: hidden;
          position: relative;
      }

      .page {
          position: absolute;
          width: 100%;
          height: 100%;
          transition: transform 0.8s ease;
      }

      .page.active {
          transform: translateX(0);
          z-index: 10;
      }

      .page.inactive-next {
          transform: translateX(100%);
          z-index: 5;
      }

      .page.inactive-prev {
          transform: translateX(-100%);
          z-index: 5;
      }

      .container {
          width: 100%;
          height: 100%;
          padding: 0.75rem;
          display: flex;
          flex-direction: column;
      }

      /* Header styles */
      .dashboard-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          background: linear-gradient(to right, #3b82f6, #1e40af);
          padding: 0.75rem 1.25rem;
          border-radius: 8px;
          color: white;
          box-shadow: var(--shadow-md);
          margin-bottom: 0.75rem;
          height: 70px;
      }

      .dashboard-title {
          font-size: 1.25rem;
          font-weight: 700;
          display: flex;
          align-items: center;
          gap: 0.75rem;
      }

      .dashboard-title i {
          font-size: 1.5rem;
      }

      .dashboard-info {
          display: flex;
          align-items: center;
          gap: 1.25rem;
      }

      .date-display {
          font-size: 0.875rem;
          display: flex;
          align-items: center;
          gap: 0.5rem;
      }

      .refresh-info {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-size: 0.875rem;
          background-color: rgba(255, 255, 255, 0.2);
          padding: 0.375rem 0.625rem;
          border-radius: 20px;
      }

      .page-indicator {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-size: 0.875rem;
          background-color: rgba(255, 255, 255, 0.2);
          padding: 0.375rem 0.625rem;
          border-radius: 20px;
      }

      .page-dot {
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background-color: rgba(255, 255, 255, 0.5);
          transition: all 0.3s ease;
      }

      .page-dot.active {
          background-color: white;
          width: 16px;
          border-radius: 4px;
      }

      /* Dashboard content styles */
      .dashboard-content {
          display: flex;
          gap: 0.75rem;
          flex: 1;
          overflow: hidden;
      }

      .stats-section {
          width: 75%;
          overflow: hidden;
      }

      .top-employees-section {
          width: 25%;
          overflow: hidden;
      }

      .section-title {
          font-size: 1rem;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: var(--dark);
          display: flex;
          align-items: center;
          gap: 0.5rem;
      }

      .section-title i {
          color: var(--primary);
      }

      /* Staff grid styles */
      .staff-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(225px, 1fr));
          gap: 0.75rem;
          overflow-y: auto;
          max-height: calc(100% - 30px);
          padding-right: 0.375rem;
      }

      .staff-grid::-webkit-scrollbar {
          width: 6px;
      }

      .staff-grid::-webkit-scrollbar-track {
          background: #f1f5f9;
      }

      .staff-grid::-webkit-scrollbar-thumb {
          background-color: #cbd5e1;
          border-radius: 3px;
      }

      .staff-card {
          background-color: white;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: var(--shadow);
          transition: all 0.3s ease;
          border: 1px solid #e2e8f0;
          display: flex;
          flex-direction: column;
          height: 275px;
      }

      .staff-card:hover {
          transform: translateY(-3px);
          box-shadow: var(--shadow-md);
      }

      .staff-header {
          padding: 0.75rem;
          display: flex;
          justify-content: space-between;
          align-items: center;
          border-bottom: 1px solid #e2e8f0;
      }

      .staff-info {
          display: flex;
          align-items: center;
          gap: 0.625rem;
      }

      .staff-avatar {
          width: 36px;
          height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 700;
          font-size: 1rem;
          color: white;
          border-radius: 50%;
          background-color: var(--primary);
      }

      .staff-name {
          font-size: 0.9375rem;
          font-weight: 600;
      }

      .staff-role {
          font-size: 0.75rem;
          color: var(--gray);
      }

      .staff-rank {
          display: flex;
          align-items: center;
          gap: 0.375rem;
          font-weight: 500;
          font-size: 0.75rem;
          padding: 0.25rem 0.5rem;
          border-radius: 20px;
          color: white;
      }

      .staff-rank.gold {
          background-color: var(--gold);
      }

      .staff-rank.silver {
          background-color: var(--silver);
      }

      .staff-rank.bronze {
          background-color: var(--bronze);
      }

      .staff-rank.regular {
          background-color: var(--gray);
      }

      .staff-body {
          padding: 0.75rem;
          flex: 1;
          display: flex;
          flex-direction: column;
      }

      .staff-stats {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 0.5rem;
          margin-bottom: 0.75rem;
      }

      .stat-item {
          text-align: center;
          padding: 0.5rem 0.25rem;
          border-radius: 6px;
          background-color: #f8fafc;
      }

      .stat-value {
          font-size: 1.125rem;
          font-weight: 700;
          margin-bottom: 0.125rem;
      }

      .stat-label {
          font-size: 0.6875rem;
          color: var(--gray);
          text-transform: uppercase;
          letter-spacing: 0.5px;
      }

      .progress-section {
          margin-bottom: 0.625rem;
      }

      .progress-title {
          display: flex;
          justify-content: space-between;
          margin-bottom: 0.25rem;
          font-size: 0.75rem;
          align-items: center;
      }

      .progress-label {
          font-weight: 500;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }

      .progress-value {
          font-weight: 700;
          white-space: nowrap;
      }

      .performance-indicator {
          height: 6px;
          width: 6px;
          border-radius: 50%;
          display: inline-block;
          margin-right: 0.25rem;
      }

      .progress-bar {
          height: 6px;
          background-color: #e2e8f0;
          border-radius: 3px;
          overflow: hidden;
      }

      .progress {
          height: 100%;
          border-radius: 3px;
      }

      .progress-success {
          background-color: var(--success);
      }

      .progress-warning {
          background-color: var(--warning);
      }

      .progress-info {
          background-color: var(--info);
      }

      .chart-container {
          height: 60px;
          margin-top: 0.625rem;
      }

      .performance-status {
          display: flex;
          align-items: center;
          gap: 0.375rem;
          font-weight: 600;
          font-size: 0.75rem;
          margin-top: auto;
      }

      .status-high {
          color: var(--success);
      }

      .status-medium {
          color: var(--warning);
      }

      .status-low {
          color: var(--danger);
      }

      .status-icon {
          font-size: 0.875rem;
      }

      /* Top employees section */
      .top-employees-container {
          background-color: white;
          border-radius: 8px;
          box-shadow: var(--shadow);
          border: 1px solid #e2e8f0;
          height: calc(100% - 30px);
          overflow: hidden;
          display: flex;
          flex-direction: column;
      }

      .top-header {
          padding: 0.75rem;
          background: linear-gradient(to right, #3b82f6, #1e40af);
          color: white;
          text-align: center;
          font-weight: 600;
          font-size: 1rem;
          border-top-left-radius: 8px;
          border-top-right-radius: 8px;
      }

      .top-body {
          flex: 1;
          display: flex;
          flex-direction: column;
          padding: 0.75rem;
          gap: 0.75rem;
          overflow-y: auto;
      }

      .top-employee-card {
          display: flex;
          background-color: #f8fafc;
          border-radius: 8px;
          padding: 0.75rem;
          box-shadow: var(--shadow-sm);
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
      }

      .top-employee-card:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow);
      }

      .top-employee-card.gold {
          background: linear-gradient(45deg, #fef3c7, #fef9c3);
          border: 1px solid #fbbf24;
      }

      .top-employee-card.silver {
          background: linear-gradient(45deg, #e5e7eb, #f3f4f6);
          border: 1px solid #9ca3af;
      }

      .top-employee-card.bronze {
          background: linear-gradient(45deg, #fed7aa, #ffedd5);
          border: 1px solid #d97706;
      }

      .top-employee-card::before {
          content: '';
          position: absolute;
          top: -15px;
          right: -15px;
          width: 30px;
          height: 30px;
      }

      .top-employee-card.gold::before {
          background-color: #fbbf24;
          transform: rotate(45deg);
      }

      .top-employee-card.silver::before {
          background-color: #9ca3af;
          transform: rotate(45deg);
      }

      .top-employee-card.bronze::before {
          background-color: #d97706;
          transform: rotate(45deg);
      }

      .top-employee-rank {
          width: 36px;
          height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          font-weight: 700;
          font-size: 1rem;
          margin-right: 0.75rem;
          color: white;
      }

      .top-employee-rank.rank-1 {
          background-color: var(--gold);
      }

      .top-employee-rank.rank-2 {
          background-color: var(--silver);
      }

      .top-employee-rank.rank-3 {
          background-color: var(--bronze);
      }

      .top-employee-details {
          flex: 1;
      }

      .top-employee-name {
          font-weight: 600;
          font-size: 0.9375rem;
          margin-bottom: 0.25rem;
      }

      .top-employee-stats {
          display: flex;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
      }

      .top-stat {
          font-size: 0.75rem;
          background-color: rgba(255, 255, 255, 0.6);
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          display: flex;
          align-items: center;
          gap: 0.25rem;
      }

      .top-stat i {
          color: var(--primary);
      }

      .top-employee-progress {
          margin-top: 0.25rem;
      }

      .top-chart {
          height: 50px;
          margin-top: 0.25rem;
      }

      /* Animation classes */
      .animation-pulse {
          animation: pulse 2s infinite;
      }

      @keyframes pulse {
          0% {
              opacity: 1;
          }
          50% {
              opacity: 0.5;
          }
          100% {
              opacity: 1;
          }
      }

      .countdown {
          font-weight: 500;
      }

      .data-update-animation {
          animation: flash-update 1s;
      }

      @keyframes flash-update {
          0% { background-color: rgba(16, 185, 129, 0); }
          50% { background-color: rgba(16, 185, 129, 0.2); }
          100% { background-color: rgba(16, 185, 129, 0); }
      }

      /* Award Page */
      .award-page {
          background: radial-gradient(circle, #1e3a8a, #0f172a);
          color: white;
      }

      .award-container {
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;
          padding: 1rem;
      }

      .award-header {
          text-align: center;
          margin-bottom: 2rem;
          margin-top: 1rem;
      }

      .award-title {
          font-size: 2.5rem;
          font-weight: 700;
          margin-bottom: 0.5rem;
          text-shadow: 0 0 10px rgba(59, 130, 246, 0.7);
          background: linear-gradient(to right, #fff, #93c5fd);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
      }

      .award-subtitle {
          font-size: 1.25rem;
          color: #93c5fd;
          margin-bottom: 1rem;
      }

      .award-date {
          font-size: 1rem;
          color: #cbd5e1;
      }

      .award-content {
          display: flex;
          justify-content: center;
          align-items: center;
          flex: 1;
          gap: 3rem;
      }

      .award-item {
          text-align: center;
          position: relative;
          transition: all 0.3s ease;
      }

      .award-item:hover {
          transform: translateY(-5px);
      }

      .award-photo-container {
          position: relative;
          width: 270px;
          height: 360px;
          margin-bottom: 1.5rem;
          border-radius: 10px;
          overflow: hidden;
          box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
      }

      .award-photo {
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: all 0.5s ease;
      }

      .award-photo-container::after {
          content: '';
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 40%;
          background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
      }

      .award-badge {
          position: absolute;
          top: -25px;
          right: -20px;
          width: 120px;
          height: 120px;
          background-size: contain;
          background-repeat: no-repeat;
          z-index: 2;
      }

      .badge-gold {
          background-image: url('/api/placeholder/120/120');
          /* In real implementation, replace with actual badge image */
      }

      .badge-silver {
          background-image: url('/api/placeholder/120/120');
          /* In real implementation, replace with actual badge image */
      }

      .award-employee-name {
          font-size: 1.75rem;
          font-weight: 700;
          color: white;
          position: absolute;
          bottom: 40px;
          left: 0;
          width: 100%;
          text-align: center;
          z-index: 3;
          text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
      }

      .award-stats {
          font-size: 1.25rem;
          color: #93c5fd;
          margin-bottom: 0.5rem;
      }

      .award-position {
          display: inline-block;
          font-size: 1.5rem;
          font-weight: 700;
          padding: 0.5rem 1.5rem;
          border-radius: 50px;
          margin-bottom: 1rem;
      }

      .position-gold {
          background: linear-gradient(to right, #fbbf24, #f59e0b);
          color: #7c2d12;
      }

      .position-silver {
          background: linear-gradient(to right, #9ca3af, #6b7280);
          color: #1f2937;
      }

      .star-rating {
          margin-top: 0.5rem;
          color: #fbbf24;
          font-size: 1.5rem;
      }

      .confetti {
          position: absolute;
          width: 10px;
          height: 10px;
          background-color: #f59e0b;
          border-radius: 50%;
          animation: confetti-fall 5s ease-in-out infinite;
      }

      @keyframes confetti-fall {
          0% {
              transform: translateY(-100vh) rotate(0deg);
              opacity: 1;
          }
          100% {
              transform: translateY(100vh) rotate(720deg);
              opacity: 0;
          }
      }

      /* Loading indicator */
      .loading-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 1000;
      }

      .spinner {
          width: 50px;
          height: 50px;
          border: 5px solid rgba(255, 255, 255, 0.3);
          border-radius: 50%;
          border-top-color: #fff;
          animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
          to { transform: rotate(360deg); }
      }

      /* Make the layout more compact */
      @media (max-height: 800px) {
          .dashboard-header {
              height: 60px;
              padding: 0.5rem 1rem;
              margin-bottom: 0.5rem;
          }

          .staff-card {
              height: 250px;
          }

          .top-employee-card {
              padding: 0.5rem;
          }

          .section-title {
              margin-bottom: 0.375rem;
          }

          .award-title {
              font-size: 2rem;
          }

          .award-subtitle {
              font-size: 1rem;
          }

          .award-photo-container {
              width: 220px;
              height: 310px;
          }
      }
    </style>
  </head>
  <body>
    <div class="page-container">
      <!-- Trang báo cáo telesales -->
      <div class="page active" id="reportPage">
        <div class="container">
          <header class="dashboard-header">
            <div class="dashboard-title">
              <i class="fas fa-chart-line"></i>
              <div>
                <h1>Megakorea - Báo Cáo Telesales</h1>
              </div>
            </div>
            <div class="dashboard-info">
              <div class="date-display">
                <i class="far fa-calendar-alt"></i>
                <span id="currentDate">Ngày 03/05/2025</span>
              </div>
              <div class="refresh-info">
                <i class="fas fa-sync-alt animation-pulse"></i>
                <span
                  >Làm mới sau
                  <span id="countdown" class="countdown">60</span>s</span
                >
              </div>
              <div class="page-indicator">
                <span class="page-dot active"></span>
                <span class="page-dot"></span>
              </div>
            </div>
          </header>

          <div class="dashboard-content">
            <!-- Phần thống kê nhân viên (3/4 bên trái) -->
            <div class="stats-section">
              <div class="section-title">
                <i class="fas fa-users"></i>
                <span>Hiệu suất nhân viên Telesales</span>
              </div>
              <div id="staffGrid" class="staff-grid">
                <!-- Dữ liệu nhân viên sẽ được điền ở đây bằng JavaScript -->
              </div>
            </div>

            <!-- Phần top 3 nhân viên (1/4 bên phải) -->
            <div class="top-employees-section">
              <div class="section-title">
                <i class="fas fa-trophy"></i>
                <span>Top 3 nhân viên xuất sắc</span>
              </div>
              <div class="top-employees-container">
                <div class="top-header">Bảng xếp hạng thành tích</div>
                <div id="topEmployees" class="top-body">
                  <!-- Top 3 nhân viên sẽ được điền ở đây bằng JavaScript -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Trang vinh danh -->
      <div class="page award-page inactive-next" id="awardPage">
        <div class="award-container">
          <div class="award-header animate__animated animate__fadeIn">
            <h1 class="award-title">VINH DANH NHÂN VIÊN XUẤT SẮC</h1>
            <p class="award-subtitle">Telesales xuất sắc nhất tháng 4/2025</p>
            <p class="award-date" id="awardDate">
              Mediccare vinh danh những đóng góp xuất sắc
            </p>
          </div>

          <div class="award-content" id="awardContent">
            <!-- Nội dung vinh danh sẽ được điền ở đây bằng JavaScript -->
          </div>
        </div>
      </div>

      <!-- Loading overlay -->
      <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="spinner"></div>
      </div>
    </div>

    <script>
      // Biến toàn cục
      let activePageIndex = 0;
      let countdownValue = 60;
      let pageRotationInterval;
      let countdownInterval;
      let apiToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjZmNGQ0NTk0NTk2Y2NjOGZjZGNjMDExIiwidG9rZW5fdHlwZSI6MCwicm9sZSI6IkFETUlOX1RFTEVTQUxFUyIsImlhdCI6MTc0NjI0MDczNywiZXhwIjoxODc1ODQwNzM3fQ.oeBg85DrrCYEQ5rXo-ubSM_98Zh9xeY_zuqb_4btNB4';
      let apiBaseUrl = 'https://api.mediccare.vn';
      let staffData = [];
      let pageRotationTime = 30000; // 30 giây mỗi trang
      let dataRefreshTime = 60000; // 1 phút làm mới dữ liệu

      // Lấy dữ liệu từ API
      async function fetchData() {
          try {
              showLoading();

              // Định dạng ngày hiện tại YYYY-MM-DD
              const today = new Date();
              const formattedDate = formatDate(today);

              const response = await fetch(`${apiBaseUrl}/customers/analytics-customer-details-of-day?date=${formattedDate}`, {
                  method: 'GET',
                  headers: {
                      'Authorization': `Bearer ${apiToken}`
                  }
              });

              if (!response.ok) {
                  throw new Error('Network response was not ok');
              }

              const data = await response.json();
              if (data.success) {
                  staffData = data.result;
                  renderDashboard(data);
                  hideLoading();
              } else {
                  console.error('API returned error:', data.message);
                  hideLoading();
                  showError('Không thể lấy dữ liệu từ API');
              }
          } catch (error) {
              console.error('Không thể lấy dữ liệu:', error);
              hideLoading();
              showError('Không thể kết nối đến máy chủ');
          }
      }

      // Hiển thị dashboard
      function renderDashboard(data) {
          if (!data.success || !data.result || !Array.isArray(data.result)) {
              console.error('Dữ liệu không hợp lệ');
              return;
          }

          // Cập nhật ngày
          updateDateDisplay();

          // Sắp xếp nhân viên theo tỷ lệ thành công (từ cao xuống thấp)
          const sortedStaff = [...data.result].sort((a, b) => b.precents_customer_success - a.precents_customer_success);

          // Tạo thẻ cho tất cả nhân viên
          renderStaffGrid(sortedStaff);

          // Hiển thị top 3 nhân viên
          renderTopEmployees(sortedStaff.slice(0, 3));

          // Tạo trang vinh danh
          renderAwardPage(sortedStaff.slice(0, 2));

          // Hiệu ứng cập nhật dữ liệu
          animateDataUpdate();
      }

      // Tạo grid hiển thị tất cả nhân viên
      function renderStaffGrid(staffList) {
          const staffGrid = document.getElementById('staffGrid');
          staffGrid.innerHTML = ''; // Xóa nội dung cũ

          // Tạo thẻ nhân viên
          staffList.forEach((staff, index) => {
              const cardHtml = createStaffCard(staff, index);
              staffGrid.innerHTML += cardHtml.html;
          });

          // Tạo các biểu đồ mini sau khi HTML đã được tạo
          setTimeout(() => {
              staffList.forEach((staff, index) => {
                  const chartId = `chart-${staff.telesales.replace(/\s+/g, '-').toLowerCase()}`;
                  createMiniChart(chartId, staff);
              });
          }, 100);
      }

      // Hiển thị top 3 nhân viên
      function renderTopEmployees(topStaff) {
          const topContainer = document.getElementById('topEmployees');
          topContainer.innerHTML = ''; // Xóa nội dung cũ

          // Tạo thẻ cho top 3 nhân viên
          topStaff.forEach((staff, index) => {
              const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : 'bronze';
              const html = createTopEmployeeCard(staff, index + 1, rankClass);
              topContainer.innerHTML += html;
          });
      }

      // Tạo trang vinh danh
      function renderAwardPage(topStaff) {
          const awardContent = document.getElementById('awardContent');
          awardContent.innerHTML = ''; // Xóa nội dung cũ

          // Chỉ lấy top 2 nhân viên xuất sắc nhất
          if (topStaff.length >= 2) {
              // Nhân viên top 1
              const gold = topStaff[0];
              const goldAwardHtml = `
                  <div class="award-item animate__animated animate__fadeInLeft">
                      <div class="award-position position-gold">Top 1</div>
                      <div class="award-photo-container">
                          <img src="https://megakorea.vn/wp-content/uploads/2025/05/Best-Telesale-T4.png" alt="Nhân viên xuất sắc" class="award-photo">
                          <div class="award-badge badge-gold"></div>
                          <div class="award-employee-name">${gold.telesales}</div>
                      </div>
                      <div class="award-stats">
                          ${gold.precents_customer_success.toFixed(1)}% tỷ lệ thành công
                      </div>
                      <div class="star-rating">
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                      </div>
                  </div>
              `;

              // Nhân viên top 2
              const silver = topStaff[1];
              const silverAwardHtml = `
                  <div class="award-item animate__animated animate__fadeInRight">
                      <div class="award-position position-silver">Top 2</div>
                      <div class="award-photo-container">
                          <img src="https://megakorea.vn/wp-content/uploads/2025/05/Best-Telesale-T4-1.png" alt="Nhân viên xuất sắc" class="award-photo">
                          <div class="award-badge badge-silver"></div>
                          <div class="award-employee-name">${silver.telesales}</div>
                      </div>
                      <div class="award-stats">
                          ${silver.precents_customer_success.toFixed(1)}% tỷ lệ thành công
                      </div>
                      <div class="star-rating">
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star"></i>
                          <i class="fas fa-star-half-alt"></i>
                      </div>
                  </div>
              `;

              awardContent.innerHTML = goldAwardHtml + silverAwardHtml;

              // Thêm hiệu ứng confetti
              createConfetti();
          }
      }

      // Tạo thẻ nhân viên
      function createStaffCard(staff, index) {
          // Xác định màu hiệu suất và trạng thái
          let performanceStatus = 'low';
          let performanceText = 'Cần cải thiện';
          let performanceIcon = 'fa-arrow-down';

          if (staff.precents_customer_success >= 40) {
              performanceStatus = 'high';
              performanceText = 'Xuất sắc';
              performanceIcon = 'fa-arrow-up';
          } else if (staff.precents_customer_success >= 25) {
              performanceStatus = 'medium';
              performanceText = 'Khá tốt';
              performanceIcon = 'fa-arrow-right';
          }

          // Xác định hạng
          let rankClass = 'regular';
          let rankText = `Top ${index + 1}`;

          if (index === 0) {
              rankClass = 'gold';
              rankText = 'Top 1';
          } else if (index === 1) {
              rankClass = 'silver';
              rankText = 'Top 2';
          } else if (index === 2) {
              rankClass = 'bronze';
              rankText = 'Top 3';
          }

          // Lấy chữ cái đầu của tên nhân viên
          const initial = staff.telesales.charAt(0);

          // Tạo ID duy nhất cho biểu đồ
          const chartId = `chart-${staff.telesales.replace(/\s+/g, '-').toLowerCase()}`;

          // Tạo HTML cho thẻ nhân viên
          const cardHtml = `
              <div class="staff-card">
                  <div class="staff-header">
                      <div class="staff-info">
                          <div class="staff-avatar">${initial}</div>
                          <div>
                              <div class="staff-name">${staff.telesales}</div>
                              <div class="staff-role">Telesales</div>
                          </div>
                      </div>
                      <div class="staff-rank ${rankClass}">
                          <i class="fas fa-trophy"></i>
                          <span>${rankText}</span>
                      </div>
                  </div>
                  <div class="staff-body">
                      <div class="staff-stats">
                          <div class="stat-item">
                              <div class="stat-value">${staff.total_customers}</div>
                              <div class="stat-label">Tổng KH</div>
                          </div>
                          <div class="stat-item">
                              <div class="stat-value">${staff.customers_success}</div>
                              <div class="stat-label">Thành công</div>
                          </div>
                          <div class="stat-item">
                              <div class="stat-value">${staff.customer_arrive}</div>
                              <div class="stat-label">Đã đến</div>
                          </div>
                      </div>

                      <div class="progress-section">
                          <div class="progress-title">
                              <div class="progress-label">
                                  <span class="performance-indicator" style="background-color: var(--success);"></span>
                                  Tỷ lệ thành công
                              </div>
                              <div class="progress-value">${staff.precents_customer_success.toFixed(1)}%</div>
                          </div>
                          <div class="progress-bar">
                              <div class="progress progress-success" style="width: ${staff.precents_customer_success}%"></div>
                          </div>
                      </div>

                      <div class="progress-section">
                          <div class="progress-title">
                              <div class="progress-label">
                                  <span class="performance-indicator" style="background-color: var(--info);"></span>
                                  Đã đến cơ sở
                              </div>
                              <div class="progress-value">${staff.precents_customer_arrive.toFixed(1)}%</div>
                          </div>
                          <div class="progress-bar">
                              <div class="progress progress-info" style="width: ${staff.precents_customer_arrive}%"></div>
                          </div>
                      </div>

                      <div class="progress-section">
                          <div class="progress-title">
                              <div class="progress-label">
                                  <span class="performance-indicator" style="background-color: var(--warning);"></span>
                                  Chưa liên hệ
                              </div>
                              <div class="progress-value">${staff.precent_customer_not_contacted.toFixed(1)}%</div>
                          </div>
                          <div class="progress-bar">
                              <div class="progress progress-warning" style="width: ${staff.precent_customer_not_contacted}%"></div>
                          </div>
                      </div>

                      <div class="chart-container" id="${chartId}"></div>

                      <div class="performance-status status-${performanceStatus}">
                          <i class="fas ${performanceIcon} status-icon"></i>
                          <span>Hiệu suất: ${performanceText}</span>
                      </div>
                  </div>
              </div>
          `;

          return { html: cardHtml, chartId: chartId };
      }

      // Tạo thẻ cho top nhân viên
      function createTopEmployeeCard(staff, rank, rankClass) {
          return `
              <div class="top-employee-card ${rankClass}">
                  <div class="top-employee-rank rank-${rank}">${rank}</div>
                  <div class="top-employee-details">
                      <div class="top-employee-name">${staff.telesales}</div>
                      <div class="top-employee-stats">
                          <div class="top-stat">
                              <i class="fas fa-users"></i>
                              <span>${staff.total_customers} KH</span>
                          </div>
                          <div class="top-stat">
                              <i class="fas fa-check-circle"></i>
                              <span>${staff.customers_success} thành công</span>
                          </div>
                      </div>
                      <div class="top-employee-progress">
                          <div class="progress-title">
                              <div class="progress-label">Tỷ lệ thành công</div>
                              <div class="progress-value">${staff.precents_customer_success.toFixed(1)}%</div>
                          </div>
                          <div class="progress-bar">
                              <div class="progress progress-success" style="width: ${staff.precents_customer_success}%"></div>
                          </div>
                      </div>
                  </div>
              </div>
          `;
      }

      // Tạo biểu đồ mini
      function createMiniChart(containerId, staffData) {
          const options = {
              series: [{
                  name: 'Thành công',
                  data: [staffData.precents_customer_success]
              }, {
                  name: 'Đã đến',
                  data: [staffData.precents_customer_arrive]
              }, {
                  name: 'Chưa liên hệ',
                  data: [staffData.precent_customer_not_contacted]
              }],
              chart: {
                  type: 'bar',
                  height: 60,
                  stacked: true,
                  toolbar: {
                      show: false
                  },
                  sparkline: {
                      enabled: true
                  }
              },
              plotOptions: {
                  bar: {
                      horizontal: true,
                      borderRadius: 3,
                  }
              },
              colors: ['#10b981', '#0ea5e9', '#f59e0b'],
              dataLabels: {
                  enabled: false
              },
              stroke: {
                  width: 1,
                  colors: ['#fff']
              },
              grid: {
                  show: false,
              },
              xaxis: {
                  labels: {
                      show: false
                  },
                  axisBorder: {
                      show: false
                  },
                  axisTicks: {
                      show: false
                  }
              },
              yaxis: {
                  show: false
              },
              tooltip: {
                  enabled: false
              },
              legend: {
                  show: false
              }
          };

          try {
              const chartElement = document.getElementById(containerId);
              if (chartElement) {
                  const chart = new ApexCharts(chartElement, options);
                  chart.render();
              }
          } catch (error) {
              console.error('Lỗi khi tạo biểu đồ:', error);
          }
      }

      // Tạo hiệu ứng confetti
      function createConfetti() {
          const confettiCount = 100;
          const colors = ['#fbbf24', '#0ea5e9', '#10b981', '#f43f5e', '#8b5cf6'];

          for (let i = 0; i < confettiCount; i++) {
              const confetti = document.createElement('div');
              confetti.className = 'confetti';

              // Random vị trí
              const left = Math.random() * 100;

              // Random màu sắc
              const colorIndex = Math.floor(Math.random() * colors.length);

              // Random kích thước
              const size = Math.random() * 10 + 5;

              // Random tốc độ rơi
              const animationDuration = Math.random() * 3 + 2;

              // Random độ trễ bắt đầu
              const animationDelay = Math.random() * 5;

              confetti.style.left = `${left}%`;
              confetti.style.backgroundColor = colors[colorIndex];
              confetti.style.width = `${size}px`;
              confetti.style.height = `${size}px`;
              confetti.style.animationDuration = `${animationDuration}s`;
              confetti.style.animationDelay = `${animationDelay}s`;

              document.getElementById('awardPage').appendChild(confetti);
          }
      }

      // Hiệu ứng khi cập nhật dữ liệu
      function animateDataUpdate() {
          const cards = document.querySelectorAll('.staff-card, .top-employee-card');
          cards.forEach(card => {
              card.classList.add('data-update-animation');
              setTimeout(() => {
                  card.classList.remove('data-update-animation');
              }, 1000);
          });
      }

      // Cập nhật hiển thị ngày hiện tại
      function updateDateDisplay() {
          const now = new Date();
          const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
          const formattedDate = now.toLocaleDateString('vi-VN', options);

          document.getElementById('currentDate').textContent = `Ngày ${formattedDate}`;

          // Cập nhật ngày trên trang vinh danh
          const month = now.getMonth() + 1;
          const year = now.getFullYear();
          document.getElementById('awardDate').textContent = `Mediccare vinh danh những đóng góp xuất sắc - Tháng ${month}/${year}`;
      }

      // Đổi trang hiển thị
      function switchPage() {
          const pages = document.querySelectorAll('.page');
          const dots = document.querySelectorAll('.page-dot');
          const currentPage = pages[activePageIndex];

          activePageIndex = (activePageIndex + 1) % pages.length;
          const nextPage = pages[activePageIndex];

          // Cập nhật class cho trang
          pages.forEach(page => {
              if (page === currentPage) {
                  page.classList.remove('active');
                  page.classList.add('inactive-prev');
              } else if (page === nextPage) {
                  page.classList.remove('inactive-next');
                  page.classList.add('active');
              } else {
                  page.classList.remove('inactive-prev');
                  page.classList.add('inactive-next');
              }
          });

          // Cập nhật chỉ báo trang
          dots.forEach((dot, index) => {
              if (index === activePageIndex) {
                  dot.classList.add('active');
              } else {
                  dot.classList.remove('active');
              }
          });
      }

      // Cập nhật đồng hồ đếm ngược
      function updateCountdown() {
          document.getElementById('countdown').textContent = countdownValue;
          countdownValue--;

          if (countdownValue < 0) {
              countdownValue = 60;
              refreshData();
          }
      }

      // Làm mới dữ liệu
      function refreshData() {
          fetchData();
      }

      // Định dạng ngày YYYY-MM-DD
      function formatDate(date) {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
      }

      // Hiển thị loading
      function showLoading() {
          document.getElementById('loadingOverlay').style.display = 'flex';
      }

      // Ẩn loading
      function hideLoading() {
          document.getElementById('loadingOverlay').style.display = 'none';
      }

      // Hiển thị thông báo lỗi
      function showError(message) {
          alert(message);
      }

      // Khởi động ứng dụng
      document.addEventListener('DOMContentLoaded', function() {
          // Lấy dữ liệu ban đầu
          fetchData();

          // Bắt đầu đếm ngược
          countdownInterval = setInterval(updateCountdown, 1000);

          // Bắt đầu chuyển trang tự động
          pageRotationInterval = setInterval(switchPage, pageRotationTime);

          // Bắt đầu làm mới dữ liệu tự động
          setInterval(refreshData, dataRefreshTime);
      });
    </script>
  </body>
</html>
